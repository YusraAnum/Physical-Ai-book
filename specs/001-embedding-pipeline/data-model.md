# Data Model: Embedding Pipeline for Docusaurus Content

## Entity: Document

**Description**: Represents a single piece of content extracted from Docusaurus (e.g., a page or section)

**Fields**:
- `id` (string): Unique identifier for the document (UUID or URL-based hash)
- `url` (string): Original URL from which the content was extracted
- `title` (string): Title of the document/page
- `content` (string): Clean text content extracted from the HTML
- `created_at` (datetime): Timestamp when the document was processed
- `updated_at` (datetime): Timestamp when the document was last updated
- `metadata` (dict): Additional metadata from the source (author, date, tags, etc.)
- `hierarchy_path` (string): Document's position in the site hierarchy (e.g., "guide/introduction")
- `word_count` (int): Number of words in the content
- `chunk_count` (int): Number of chunks the document was split into

**Validation Rules**:
- `url` must be a valid URL format
- `content` must not be empty after cleaning
- `id` must be unique across all documents

## Entity: Embedding

**Description**: Vector representation of document content generated by Cohere API, stored in Qdrant with document metadata for retrieval

**Fields**:
- `id` (string): Unique identifier that matches the source document
- `document_id` (string): Reference to the source Document entity
- `vector` (list[float]): The embedding vector (dimension depends on model used)
- `chunk_text` (string): The specific text chunk that was embedded
- `chunk_index` (int): Position of this chunk within the original document
- `metadata` (dict): Extended metadata including source URL, title, hierarchy
- `created_at` (datetime): Timestamp when the embedding was generated

**Validation Rules**:
- `vector` must have consistent dimensions across all embeddings
- `document_id` must reference an existing Document
- `chunk_text` must not exceed maximum size limits for the embedding model

## Entity: Chunk

**Description**: A segment of text content that has been split from a larger document for embedding

**Fields**:
- `id` (string): Unique identifier for the chunk
- `document_id` (string): Reference to the parent Document
- `content` (string): The text content of this chunk
- `start_pos` (int): Starting position in the original document
- `end_pos` (int): Ending position in the original document
- `chunk_index` (int): Sequential index of this chunk within the document
- `word_count` (int): Number of words in this chunk
- `char_count` (int): Number of characters in this chunk
- `semantic_boundary` (string): Type of boundary that determined this chunk (heading, paragraph, etc.)

**Validation Rules**:
- `content` length must be within minimum and maximum size limits
- `start_pos` and `end_pos` must be valid positions within the parent document
- `chunk_index` must be sequential within the document

## Entity: Configuration

**Description**: Parameters that control the behavior of the pipeline including URLs to crawl, embedding model settings, and storage options

**Fields**:
- `base_url` (string): Root URL of the Docusaurus site to crawl
- `crawl_depth` (int): Maximum depth to crawl from the base URL (default: 3)
- `max_documents` (int): Maximum number of documents to process (null for unlimited)
- `chunk_size` (int): Maximum size of text chunks in characters (default: 1000)
- `chunk_overlap` (int): Number of characters to overlap between chunks (default: 200)
- `cohere_model` (string): Name of the Cohere embedding model to use (default: "embed-multilingual-v3.0")
- `cohere_input_type` (string): Input type for Cohere API (default: "search_document")
- `qdrant_collection_name` (string): Name of the Qdrant collection (default: "rag-embeddings")
- `batch_size` (int): Number of documents to process in each batch (default: 10)
- `rate_limit_delay` (float): Delay in seconds between API calls (default: 0.1)
- `include_patterns` (list[string]): URL patterns to include in crawling (default: all)
- `exclude_patterns` (list[string]): URL patterns to exclude from crawling (default: none)

**Validation Rules**:
- `base_url` must be a valid URL
- `crawl_depth` must be positive
- `chunk_size` must be within reasonable limits (100-4000 characters)
- `chunk_overlap` must be less than `chunk_size`
- `batch_size` must be positive and reasonable (1-100)

## Relationships

```
Document (1) -----> (0..n) Chunk
Chunk (1) -----> (1) Embedding
Document (1) -----> (1) Embedding
Configuration (1) -----> (0..n) Document
```

## State Transitions

### Document States:
- `pending` → `processing` → `completed` | `failed`
- New documents start in `pending` state
- During extraction, documents transition to `processing` state
- After successful processing, documents transition to `completed` state
- If processing fails, documents transition to `failed` state

### Embedding States:
- `pending` → `embedding` → `stored` | `failed`
- Embeddings start in `pending` state when their document is processed
- During Cohere API call, embeddings transition to `embedding` state
- After successful storage in Qdrant, embeddings transition to `stored` state
- If embedding or storage fails, embeddings transition to `failed` state