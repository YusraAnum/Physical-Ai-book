# Data Model: RAG-Enabled Backend Agent

## Entities

### Query
**Description**: A natural language question or request from the user that triggers the RAG process

**Fields**:
- `query_text` (string, required): The user's question or request text
- `document_filters` (list of strings, optional): Specific document identifiers to limit retrieval scope (default: null for full content search)
- `user_id` (string, optional): Identifier for the user making the query (for potential future use)
- `query_id` (string, optional): Unique identifier for the query (auto-generated if not provided)

### RetrievedChunk
**Description**: Document segments retrieved from Qdrant vector database that are relevant to the user's query

**Fields**:
- `chunk_id` (string, required): Unique identifier for the document chunk
- `content` (string, required): The actual text content of the chunk
- `document_id` (string, required): Identifier of the source document
- `metadata` (dict, optional): Additional metadata about the chunk (source URL, page number, etc.)
- `similarity_score` (float, required): Similarity score from the vector search (0.0 to 1.0)

### AgentResponse
**Description**: The final answer generated by the OpenAI Agent based on retrieved context, containing both the answer and source attribution

**Fields**:
- `response_id` (string, required): Unique identifier for the response
- `query_id` (string, required): Reference to the original query
- `answer` (string, required): The generated answer text
- `source_chunks` (list of RetrievedChunk, optional): List of chunks that informed the response
- `confidence_level` (float, optional): Confidence score for the response (0.0 to 1.0)
- `timestamp` (datetime, required): When the response was generated
- `has_sources` (boolean, required): Whether the response was generated from retrieved sources

### VectorDatabaseConnection
**Description**: Configuration parameters and credentials for connecting to Qdrant cloud service

**Fields**:
- `qdrant_url` (string, required): URL for the Qdrant instance
- `qdrant_api_key` (string, required): API key for authentication
- `collection_name` (string, required): Name of the vector collection to search
- `vector_size` (integer, required): Dimension of the vectors in the collection

## Relationships
- One Query can result in multiple RetrievedChunk objects (one-to-many)
- Multiple RetrievedChunk objects contribute to one AgentResponse (many-to-one)
- One VectorDatabaseConnection is used to retrieve multiple RetrievedChunk objects (one-to-many)

## Validation Rules
- Query.query_text must be between 1 and 2000 characters
- RetrievedChunk.similarity_score must be between 0.0 and 1.0
- AgentResponse.answer must not be empty when has_sources is true
- Query.document_filters, if provided, must reference existing document IDs
- All API keys and URLs must be properly formatted

## State Transitions
1. Query is received → Validation occurs → Valid Query
2. Valid Query → Retrieval performed → RetrievedChunk(s) generated
3. RetrievedChunk(s) + Query → Agent processing → AgentResponse generated
4. AgentResponse → Returned to user → Process complete

## Constraints
- RetrievedChunk objects are read-only (they represent stored document segments)
- AgentResponse objects are immutable once created
- Query objects may have timeout constraints (e.g., 30 seconds for processing)